{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ object.name }} - ArtEkat</title>
    <link rel="shortcut icon" type="image/png" href="{% static "deps/media/logo.svg" %}"/>
</head>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="{% static "deps/css/artStyle.css" %}"/>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
<body class="body">
  <div class="art">
    <div class="frame-2">
      <div class="frame-7">
        <img
          alt=""
          class="compass"
          src="https://static.overlay-tech.com/assets/757ed013-3834-4713-a8b2-8711d46b5610.svg"
        />
        <div class="frame-10"><button onclick="window.open(`{% url "main:index" %}`)" class="kontakty">Главная</button></div>
        <div class="frame-10"><button onclick="window.open(`{% url "map:map" %}`)" class="kontakty">Карта</button></div>
        <div class="frame-10"><button onclick="window.open(`{% url "main:about" %}`)" class="kontakty">О&nbsp;нас</button></div>
      </div>
      {% if not user.is_authenticated %}
            <button onclick="window.open(`{% url "user:login" %}`)" class="frame-11"><p class="vhod">Вход</p></button>
              {% else %}
              <span class="frame-11"><p class="vhod ">{{ user }}</p></span>
            {% endif %}
    </div>
    <div class="frame-86">
      <img
      id="place-image"
      alt=""
      class="frame-73"
      src={{ object.image.url }}
      />
      <div id="place-info" style=" box-shadow: 0 0 11px rgba(115, 55, 55, 0.89); margin-top: 45px; background-color: rgba(197, 104, 104, 0.5);border: 1px solid #ccc;border-radius: 8px; padding: 10px;margin-bottom: 10px;word-wrap: break-word;overflow-wrap: break-word; width: 680px;">
        <h1 id="place-name" style="  font-weight: 600; color: rgba(115, 55, 55, 1);margin-bottom: 20px;letter-spacing: 0.72px;">{{ object.name }}</h1>
        <div style="display: flex; flex-direction: row;">
          <p class="avtor-imja-familija"><b>Автор:</b>&nbsp;{{ object.author }}</p>
          <p id="autor-description" class="avtor-imja-familija"></p>
        </div>
        <div style="display: flex; flex-direction: row;">
          <p class="avtor-imja-familija"><b>Адрес:</b>&nbsp;{{ object.adress }}</p>
          <p id="street" class="avtor-imja-familija">
          </p>
        </div>
        <p class="avtor-imja-familija-emphasis-0" id="place-description"><b>Описание места:</b>&nbsp;</p>
          <p class="avtor-imja-familija-emphasis-0">{{ object.info }}</p>

        <div style="display: flex; flex-direction: row;">
          <p class="avtor-imja-familija"><b>Рейтинг:&nbsp;</b></p>
            {% if object.rate == 0.0 %}
            <p class="avtor-imja-familija-2">Отсутствет</p>
            {% else %}
            <div class="col text-center govno" style="margin-right: 428px">
                {% if object.rate <= 1.5 %}
                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle" ></span>
                {% elif  object.rate <= 2.5 %}

                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle" ></span>
                {% elif object.rate <= 3.5 %}
                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle" ></span>
                {% elif object.rate <= 4.5 %}
                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle" ></span>
                {% elif  object.rate <= 5 %}
                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                {% endif %}
                <p class="avtor-imja-familija-1"> {{ object.rate }}</p>
            </div>
            {% endif %}
          <p id="autor-description" class="avtor-imja-familija"></p>
        </div>
      </div>
    </div>
    <!-- Форма для комментариев -->
    <div class="addCommenter">
        {% if user.is_authenticated %}
      <h2 style="font-weight: 600">Добавить отзыв</h2>
      <form class="form-1" action="" method="POST" id="{{object.id}}" >
            {% csrf_token %}
          <textarea id="comment" class="my-form" placeholder="Поделитесь своим мнением об Арт-объекте!" required></textarea>
          <div class="col text-center govno-2">
                <button type="button" class="fa fa-star fa-3x my-btn starStyle" id="first"></button>
                <button type="button" class="fa fa-star fa-3x my-btn starStyle" id="second"></button>
                <button type="button" class="fa fa-star fa-3x my-btn starStyle" id="third"></button>
                <button type="button" class="fa fa-star fa-3x my-btn starStyle" id="fourth"></button>
                <button type="button" class="fa fa-star fa-3x my-btn starStyle" id="fifth"></button>
            </div>
          <div style = "text-align: center; margin-top: 30px; margin-left:-10px; margin-bottom: 100px;">
              <button id="commentButton" class="addCommentButton disabled" onclick="getText()">Оставить отзыв</button>
          </div>
      </form>
         {% else %}
            <p>Авторизуйтесь, чтобы получить возможность оставить свой отзыв об Арт-объекте! </p>
        {% endif %}
    </div>
    <!-- Секция для отображения комментариев -->
    <div class="comments-1" id="commentsSection">
      <h2 style="color: rgba(41, 108, 99, 1); margin-right: 10px; margin-bottom: 50px; font-weight: 800;">Отзывы</h2>
      <div id="commentsList">
      {% if comments.first == none %}
          <p class="net-otzyv">Пока никто не оставил отзыв, но вы можете стать <u>первым</u>!</p>
      {% else %}
        {% for comment in comments %}
      <blockquote class="comment-container">
        <p class="name-user">{{ comment.author}}</p>
        <div class="border-1"></div>
        <p class="caption">{{ comment.caption}}</p>
          <div class="govno-1" style="margin-right: 428px">
                {% if object.rate == 1.0 %}
                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle" ></span>
                {% elif  object.rate == 2.0 %}

                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle" ></span>
                {% elif object.rate <= 3.0 %}
                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle" ></span>
                {% elif object.rate <= 4.0 %}
                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle" ></span>
                {% elif  object.rate <= 5.0 %}
                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                    <span class="fa fa-star fa-3x my-btn starStyle active" ></span>
                {% endif %}
            </div>
        <p class="date_posted">{{ comment.date_posted}}</p>

      </blockquote>
    {% endfor %}
      </div>
    </div>
    {% endif %}

    <div class="frame-3">
      <img
        alt=""
        class="compass-two"
        src="https://static.overlay-tech.com/assets/d326b5ec-204f-4bef-a085-eebf9e7dde34.svg"
      />
      <div>
        <div class="mainAndVk">
          <form action="https://mail.google.com/mail/u/0/#search/artekat196@gmail.com?compose=jrjtWvPDnJBBWmKptLwgxLlTqklCxfqQvxDgwfRBfQDlBkGLFkKWHgNqKHDMDFCRkPVjwXvb" target="_blank">
            <button class="mail"></button>
          </form>
          <form action="https://vk.com/id323571725" target="_blank">
            <button class="vk"></button>
          </form>
        </div>
      </div>
    </div>
  </div>

<script>
const one = document.getElementById('first')
const two = document.getElementById('second')
const three = document.getElementById('third')
const four = document.getElementById('fourth')
const five = document.getElementById('fifth')
const commentButton = document.getElementById('commentButton')
let commments = document.getElementsByClassName('comment-container').length
commentButton.disabled = true;
// get the form, confirm-box and csrf token
const form = document.querySelector('.form-1')
const confirmBox = document.getElementById('confirm-box')
const csrf = document.getElementsByName('csrfmiddlewaretoken')

const handleStarSelect = (size) => {
    const children = form.children

    for (let i=2; i < children.length; i++) {
        if(i <= size) {
            children[i].classList.add('active')
        } else {
            children[i].classList.remove('active')
        }
    }
}

const handleSelect = (selection) => {
    switch(selection){
        case 'first': {
             one.classList.add('active')
             two.classList.remove('active')
             three.classList.remove('active')
             four.classList.remove('active')
             five.classList.remove('active')
            return
        }
        case 'second': {
            one.classList.add('active')
             two.classList.add('active')
             three.classList.remove('active')
             four.classList.remove('active')
             five.classList.remove('active')
            return
        }
        case 'third': {
            one.classList.add('active')
             two.classList.add('active')
             three.classList.add('active')
             four.classList.remove('active')
             five.classList.remove('active')
            return
        }
        case 'fourth': {
            one.classList.add('active')
             two.classList.add('active')
             three.classList.add('active')
             four.classList.add('active')
             five.classList.remove('active')
            return
        }
        case 'fifth': {
            one.classList.add('active')
             two.classList.add('active')
             three.classList.add('active')
             four.classList.add('active')
             five.classList.add('active')
            return
        }
        default: {
            one.classList.remove('active')
             two.classList.remove('active')
             three.classList.remove('active')
             four.classList.remove('active')
             five.classList.remove('active')
        }
    }

}

const getNumericValue = (stringValue) =>{
    let numericValue;
    if (stringValue === 'first') {
        numericValue = 1
    }
    else if (stringValue === 'second') {
        numericValue = 2
    }
    else if (stringValue === 'third') {
        numericValue = 3
    }
    else if (stringValue === 'fourth') {
        numericValue = 4
    }
    else if (stringValue === 'fifth') {
        numericValue = 5
    }
    else {
        numericValue = 0
    }
    return numericValue
}
let commentText = ''
function getText() {
            commentText = document.getElementById('comment').value;
}
if (one) {
    const arr = [one, two, three, four, five]
    let val = 0;
    arr.forEach(item=> item.addEventListener('mouseover', (event)=>{
        handleSelect(event.target.id)
    }))

    arr.forEach(item=> item.addEventListener('click', (event)=>{
        // value of the rating not numeric
        commentButton.disabled = false;
        commentButton.classList.remove("disabled")
        val = getNumericValue(event.target.id)
        commentButton.addEventListener('click', function (event){
        event.preventDefault();
        const csrftoken = getCookie('csrftoken');
        let data = [val, commentText, commments]
        console.log(data)
            $.ajax({
                type: 'POST',
                url: '{% url "rating:post" object.slug%} ',
                headers: { 'X-CSRFToken': csrftoken },
                contentType: 'application/json',
                    data: JSON.stringify(data),
                success: function(response){
                     location.reload ();
                },
                error: function(error){
                    console.log(error)
                }
            })
        })
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    }))
}


</script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>